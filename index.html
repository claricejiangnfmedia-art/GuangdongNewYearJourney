<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>å¹¿åºœå¹´å‘³ä¹‹æ—… | Guangdong New Year Journey</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(180deg, #ff6b6b 0%, #ffd93d 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .game-container {
            width: 100%;
            max-width: 400px;
            height: 85vh;
            background: white;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .page {
            width: 100%;
            height: 100%;
            display: none;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .page.active {
            display: block;
        }
        
        /* ============ å¼€å±é¡µé¢æ ·å¼ ============ */
        #languagePage {
            position: relative;
            background: #c1272d; /* å¤‡ç”¨åº•è‰² */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            height: 100%;
        }
        
/* ---------- ç»ˆæä¿®å¤ï¼šèƒŒæ™¯å›¾ç‰‡å¼ºåˆ¶100%è¦†ç›–æ•´ä¸ªæ¨¡å— ---------- */
.bg-wrapper {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;     /* å¼ºåˆ¶è·Ÿéšçˆ¶å®¹å™¨é«˜åº¦ */
    min-height: 100% !important; /* åŒé‡ä¿éšœ */
    max-height: 100% !important;
    z-index: 1;
    pointer-events: none;
    overflow: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
}

#bgImage {
    width: 100% !important;
    height: 100% !important;     /* å¼ºåˆ¶å¡«æ»¡æ•´ä¸ªbg-wrapper */
    display: block !important;
    object-fit: cover !important; /* è£å‰ªå¡«å……ï¼Œä¿è¯ä¸ç•™ç™½ */
    object-position: center !important; /* å±…ä¸­è£å‰ªï¼Œä¿è¯ä¸»ä½“å¯è§ */
    filter: brightness(1) !important;
    opacity: 1 !important;
    position: relative !important;
}

/* çˆ¶å®¹å™¨å¼ºåˆ¶ç›¸å¯¹å®šä½ï¼Œç¡®ä¿èƒŒæ™¯å®¹å™¨ç»å¯¹å®šä½ç”Ÿæ•ˆ */
#languagePage {
    position: relative !important;
    background: #c1272d;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    height: 100%;
}

/* èƒŒæ™¯å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶çš„å¤‡ç”¨çº¹ç† - åŒæ ·å¼ºåˆ¶100%è¦†ç›– */
.bg-wrapper.bg-fallback {
    background: linear-gradient(145deg, #c1272d, #e63946) !important;
    width: 100% !important;
    height: 100% !important;
    min-height: 100% !important;
}

.bg-wrapper.bg-fallback::after {
    content: "ğŸ‰ğŸ§§ğŸ®ğŸ‹ğŸ´ğŸ§¨ğŸŠğŸŒ¸";
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    font-size: 60px;
    opacity: 0.1;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    pointer-events: none;
    color: #ffd700;
    letter-spacing: 20px;
    line-height: 2;
    white-space: pre-wrap;
    word-break: break-all;
}
        
        /* å†…å®¹å±‚ - å¿…é¡»é«˜äºèƒŒæ™¯ï¼Œå¹¶ä¸”è·Ÿéšæ»šåŠ¨ */
        .language-content {
            position: relative;
            z-index: 20;
            width: 100%;
            min-height: 100%;         /* æœ€å°é«˜åº¦æ’‘æ»¡è§†å£ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 60px 30px 80px;
            text-align: center;
            background: linear-gradient(
                180deg, 
                rgba(255, 215, 0, 0.35) 0%, 
                rgba(255, 107, 107, 0.25) 50%,
                rgba(193, 39, 45, 0.4) 100%
            );
            backdrop-filter: brightness(1.1);
            /* ç¡®ä¿å†…å®¹åŒºæœ‰è¶³å¤Ÿçš„å†…è¾¹è·ï¼Œå°å±å¹•ä¹Ÿèƒ½é€šè¿‡æ»šåŠ¨çœ‹åˆ°åº•éƒ¨ */
        }
        
        /* è§„åˆ™æŒ‰é’® - ä¿æŒåœ¨æœ€ä¸Šå±‚ */
        .rules-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: rgba(255, 215, 0, 0.9);
            border: 2px solid #c1272d;
            border-radius: 50%;
            color: #c1272d;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            z-index: 30;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* è§„åˆ™å¼¹çª— */
        .rules-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .rules-modal.active {
            display: flex;
        }
        
        .rules-content {
            background: white;
            width: 85%;
            max-width: 350px;
            border-radius: 20px;
            padding: 25px;
            max-height: 80vh;
            overflow-y: auto;
            border: 5px solid #ffd700;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .rules-title {
            color: #c1272d;
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }
        
        .rules-text {
            color: #333;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .rules-text.english {
            color: #666;
            font-style: italic;
            border-left: 3px solid #ff6b6b;
            padding-left: 10px;
            margin-bottom: 20px;
        }
        
        .rules-close {
            background: #c1272d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            margin-top: 15px;
            cursor: pointer;
            display: block;
            width: 100%;
        }
        
        .language-title {
            color: #ffd700 !important;
            font-size: 36px;
            margin-bottom: 15px;
            text-shadow: 3px 3px 0 rgba(193, 39, 45, 0.9);
            font-weight: bold;
            line-height: 1.2;
            padding: 0 20px;
        }
        
        .language-title span {
            display: block;
            font-size: 24px;
            margin-top: 10px;
            color: white;
            text-shadow: 2px 2px 0 rgba(193, 39, 45, 0.8);
            font-weight: 600;
        }
        
        .language-subtitle {
            color: white !important;
            font-size: 18px;
            margin-bottom: 50px;
            text-shadow: 1px 1px 2px rgba(193, 39, 45, 0.9);
            background: rgba(193, 39, 45, 0.7);
            padding: 12px 25px;
            border-radius: 20px;
            line-height: 1.5;
            max-width: 320px;
        }
        
        .language-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 280px;
            margin-bottom: 40px;
        }
        
        .language-btn {
            padding: 20px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.95);
            color: #c1272d !important;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 10px 25px rgba(193, 39, 45, 0.4);
        }
        
        .language-btn:active {
            transform: scale(0.95);
            background: white;
        }
        
        .language-hint {
            margin-top: 20px;
            color: #ffd700;
            font-size: 18px;
            text-shadow: 1px 1px 0 #c1272d;
            background: rgba(193, 39, 45, 0.6);
            padding: 12px 20px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            max-width: 300px;
        }
        
        .language-hint p {
            margin: 0 0 8px 0;
            font-weight: bold;
        }
        
        .language-hint span {
            display: block;
            font-size: 14px;
            color: white;
            opacity: 0.95;
            line-height: 1.4;
        }
        
        /* ============ å…¶ä»–é¡µé¢æ ·å¼ä¿æŒä¸å˜ ============ */
        /* æ‹ç«‹å¾—å¼¹çª—æ ·å¼ */
        .polaroid-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .polaroid-modal.active {
            display: flex;
        }
        
        .polaroid {
            width: 300px;
            background: white;
            padding: 15px;
            padding-bottom: 60px;
            border-radius: 2px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: rotate(1deg);
            position: relative;
            border: 10px solid white;
        }
        
        .polaroid-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: #f5f5f5;
            border: 1px solid #ddd;
        }
        
        .polaroid-text {
            padding: 15px 5px;
            text-align: center;
        }
        
        .polaroid-title {
            color: #c1272d;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .polaroid-desc {
            color: #333;
            font-size: 16px;
            line-height: 1.4;
            margin-bottom: 15px;
        }
        
        .polaroid-stats {
            display: flex;
            justify-content: space-around;
            background: #fff9e6;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px dashed #ff9a9e;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            color: #c1272d;
            font-weight: bold;
            font-size: 18px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .polaroid-collect {
            background: #e8f5e9;
            padding: 8px;
            border-radius: 5px;
            margin-top: 10px;
            color: #2e7d32;
            font-weight: bold;
        }
        
        /* æ¸¸æˆé¡µé¢æ ·å¼ */
        #gamePage {
            background: #fffaf0;
        }
        
        .scene-area {
            height: 60%;
            position: relative;
            overflow: hidden;
        }
        
        #sceneImage {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .scene-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            color: white;
            padding: 20px;
            min-height: 150px;
        }
        
        #sceneTitle {
            color: #ffd700;
            font-size: 1.4rem;
            margin-bottom: 10px;
        }
        
        #sceneText {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        #cantoneseText {
            font-style: italic;
            color: #a8e6cf;
            border-left: 3px solid #a8e6cf;
            padding-left: 10px;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .options-area {
            height: 30%;
            padding: 15px;
            overflow-y: auto;
            background: #fff9e6;
        }
        
        .option-btn {
            width: 100%;
            padding: 16px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .option-btn:active {
            transform: translateY(3px);
        }
        
        .status-bar {
            height: 10%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 2px solid #ff9a9e;
            padding: 0 10px;
        }
        
        .status-item {
            text-align: center;
        }
        
        .status-value {
            font-size: 1.2rem;
            color: #c1272d;
            font-weight: bold;
        }
        
        .status-label {
            font-size: 0.75rem;
            color: #666;
        }
        
        /* ç»“å±€ç»“ç®—é¡µé¢ */
        #endingPage {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            padding: 20px;
            text-align: center;
            overflow-y: auto;
            display: none;
        }
        
        #endingPage.active {
            display: block;
        }
        
        #endingTitle {
            color: #c1272d;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        
        #endingImage {
            width: 100%;
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            border: 5px solid #ffd700;
            margin: 0 auto 20px;
            display: block;
        }
        
        .ending-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 0 auto 20px;
            max-width: 350px;
            font-size: 1.1rem;
            color: #333;
        }
        
        .ending-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #fff9e6;
            border-radius: 10px;
        }
        
        .ending-stat-item {
            text-align: center;
            padding: 10px;
        }
        
        .ending-stat-value {
            font-size: 24px;
            color: #c1272d;
            font-weight: bold;
        }
        
        .ending-stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .achievement-list {
            text-align: center;
            margin: 20px 0;
        }
        
        .achievement-item {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 15px;
            margin: 12px 0;
            border-radius: 12px;
            border: 3px solid #4CAF50;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            animation: achievementPop 0.5s ease-out;
        }
        
        @keyframes achievementPop {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .achievement-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            color: #2e7d32;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-desc {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .no-achievement {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            color: #999;
            font-style: italic;
            margin: 20px 0;
        }
        
        .ending-type {
            background: linear-gradient(135deg, #ffd93d 0%, #ff9a9e 100%);
            padding: 15px;
            border-radius: 12px;
            margin: 20px 0;
            border: 3px solid #ffd700;
        }
        
        .ending-type-title {
            color: #c1272d;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .ending-type-desc {
            color: #333;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .ending-action-btn {
            width: 200px;
            padding: 15px;
            margin: 8px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        #drawFortuneBtn {
            background: linear-gradient(135deg, #c1272d, #ff6b6b);
            color: white;
        }
        
        /* æ–°å¹´ç­¾é¡µé¢ */
        #fortunePage {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            padding: 20px;
            text-align: center;
            overflow-y: auto;
        }
        
        #fortuneTitle {
            color: #c1272d;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        
        #fortuneImage {
            width: 100%;
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 15px;
            border: 5px solid #ffd700;
            margin: 0 auto 20px;
            display: block;
        }
        
        .fortune-text {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 0 auto 20px;
            max-width: 350px;
            font-size: 1.1rem;
            color: #333;
        }
        
        .action-btn {
            width: 200px;
            padding: 15px;
            margin: 8px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        #shareBtn {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        #retryBtn {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
            color: white;
        }
        
        #homeBtn {
            background: linear-gradient(135deg, #9C27B0, #6A1B9A);
            color: white;
        }
        
        .qrcode-section {
            background: white;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
        }
        
        #qrcodeImg {
            width: 150px;
            height: 150px;
            margin: 10px auto;
            display: block;
            border: 2px solid #ff9a9e;
        }

        #message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 30px;
            z-index: 2000;
            display: none;
            font-size: 16px;
            border: 2px solid #ffd700;
        }
        /* ============ BGM æ§åˆ¶æŒ‰é’®æ ·å¼ ============ */
.bgm-btn {
    position: absolute;
    top: 15px;
    left: 15px;
    width: 40px;
    height: 40px;
    background: rgba(255, 215, 0, 0.9);
    border: 2px solid #c1272d;
    border-radius: 50%;
    color: #c1272d;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
}

.bgm-btn.muted {
    background: rgba(200, 200, 200, 0.9);
    color: #666;
    border-color: #666;
}

.bgm-btn.muted::after {
    content: "";
    position: absolute;
    width: 2px;
    height: 24px;
    background: #666;
    transform: rotate(45deg);
    border-radius: 2px;
}
    </style>
</head>
<body>
    <!-- æ‹ç«‹å¾—å¼¹çª— -->
    <div class="polaroid-modal" id="polaroidModal">
        <div class="polaroid">
            <img class="polaroid-image" id="polaroidImage" alt="é€‰é¡¹ç»“æœå›¾ç‰‡">
            <div class="polaroid-text">
                <div class="polaroid-title" id="polaroidTitle">é€‰é¡¹ç»“æœ</div>
                <div class="polaroid-desc" id="polaroidDesc"></div>
                <div class="polaroid-stats" id="polaroidStats"></div>
                <div class="polaroid-collect" id="polaroidCollect"></div>
            </div>
        </div>
    </div>
    
    <!-- æ¶ˆæ¯æç¤º -->
    <div id="message"></div>
    
    <!-- æ¸¸æˆå®¹å™¨ -->
    <div class="game-container">
        <!-- BGM æ§åˆ¶æŒ‰é’® - å›ºå®šåœ¨æ¸¸æˆå®¹å™¨å·¦ä¸Šè§’ -->
<button id="bgmToggle" class="bgm-btn">ğŸµ</button>

<!-- éšè—çš„éŸ³é¢‘å…ƒç´  -->
<audio id="bgmAudio" loop preload="auto">
    <source src="images/bgm.mp3" type="audio/mpeg">
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ 
</audio>
        <!-- è¯­è¨€é€‰æ‹©é¡µé¢ - é‡æ„èƒŒæ™¯ç»“æ„ï¼Œä¿è¯æ»šåŠ¨æ—¶å›¾ç‰‡å®Œæ•´è·Ÿéš -->
        <div id="languagePage" class="page active">
            <!-- èƒŒæ™¯ç‹¬ç«‹åŒ…è£…ï¼šç»å¯¹å®šä½ï¼Œä½†é«˜åº¦éšå†…å®¹æ’‘å¼€ï¼Œä¿è¯æ»šåŠ¨åˆ°åº•éƒ¨ä»æœ‰èƒŒæ™¯ -->
            <div class="bg-wrapper" id="bgWrapper">
                <img id="bgImage" alt="æ–°æ˜¥èƒŒæ™¯å›¾">
            </div>
            
            <!-- è§„åˆ™æŒ‰é’® -->
            <button class="rules-btn" id="rulesBtn">?</button>
            
            <!-- è§„åˆ™å¼¹çª— -->
            <div class="rules-modal" id="rulesModal">
                <div class="rules-content">
                    <h3 class="rules-title">ğŸ® æ¸¸æˆè§„åˆ™</h3>
                    <p class="rules-text">æ¬¢è¿æ¥åˆ°ã€Šå¹¿åºœå¹´å‘³ä¹‹æ—…ã€‹ï¼åœ¨æ¸¸æˆä¸­ï¼Œæ‚¨å°†ä½“éªŒä»å¹´å»¿å…«åˆ°å…ƒå®µèŠ‚çš„å®Œæ•´å¹¿ä¸œæ˜¥èŠ‚ä¹ ä¿—ã€‚</p>
                    <p class="rules-text">æ¯ä¸ªåœºæ™¯éƒ½æœ‰ä¸åŒçš„é€‰é¡¹ï¼Œæ‚¨çš„é€‰æ‹©ä¼šå½±å“ï¼š</p>
                    <p class="rules-text">âœ¨ <strong>å¥½è¿å€¼</strong>ï¼šå½±å“æ–°å¹´ç­¾çš„è´¨é‡</p>
                    <p class="rules-text">ğŸ’° <strong>åˆ©æ˜¯é’±</strong>ï¼šæ˜¥èŠ‚æ”¶åˆ°çš„çº¢åŒ…é‡‘é¢</p>
                    <p class="rules-text">ğŸ <strong>æ”¶é›†ç‰©å“</strong>ï¼šè§£é”ç‰¹æ®Šæˆå°±</p>
                    <p class="rules-text">ä¸åŒçš„é€‰æ‹©ç»„åˆä¼šè§£é”ä¸åŒçš„æˆå°±ï¼</p>
                    <p class="rules-text">æ‰€æœ‰åœºæ™¯å®Œæˆåï¼Œå°†æ ¹æ®æ‚¨çš„è¡¨ç°è·å¾—æœ¬æ¬¡æ¸¸ç©çš„æˆå°±ã€‚</p>
                    <p class="rules-text">æœ€åï¼Œæ‚¨å°†æŠ½å–ä¸“å±çš„æ–°å¹´å¥½è¿ç­¾ï¼</p>
                    
                    <h3 class="rules-title">ğŸ“ Game Rules</h3>
                    <p class="rules-text english">Welcome to Guangdong New Year Journey! You will experience all the local traditional Chinese New Year customs.</p>
                    <p class="rules-text english">Each scene offers different choices that affect:</p>
                    <p class="rules-text english">âœ¨ <strong>Luck Points</strong>: Affect fortune quality</p>
                    <p class="rules-text english">ğŸ’° <strong>Red Packets</strong>: Money received during Chinese New Year</p>
                    <p class="rules-text english">ğŸ <strong>Collected Items</strong>: Unlock special achievements!</p>
                    <p class="rules-text english">Different choice combinations unlock different achievements!</p>
                    <p class="rules-text english">Complete all scenes to get achievements for this playthrough.</p>
                    <p class="rules-text english">Finally, draw your unique New Year fortune!</p>
                    
                    <button class="rules-close" id="rulesClose">æˆ‘çŸ¥é“äº† / I Understand</button>
                </div>
            </div>
            
            <!-- å†…å®¹å±‚ - ä½äºèƒŒæ™¯ä¹‹ä¸Šï¼Œé«˜åº¦æ’‘å¼€çˆ¶å®¹å™¨ -->
            <div class="language-content">
                <div style="margin-bottom: 30px;">
                    <h1 class="language-title">
                        å¹¿åºœå¹´å‘³ä¹‹æ—…
                        <span>Guangdong New Year Journey</span>
                    </h1>
                </div>
                
                <p class="language-subtitle">
                    ä½“éªŒå¹¿ä¸œæ˜¥èŠ‚ä¼ ç»Ÿä¹ ä¿—<br>
                    Experience Cantonese New Year Traditions
                </p>
                
                <div class="language-buttons">
                    <button id="chineseBtn" class="language-btn">ğŸ‡¨ğŸ‡³ ä¸­æ–‡ç‰ˆ</button>
                    <button id="englishBtn" class="language-btn">ğŸŒ English Version</button>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆä¸»é¡µé¢ -->
        <div id="gamePage" class="page">
            <div class="scene-area">
                <img id="sceneImage" alt="åœºæ™¯å›¾">
                <div class="scene-overlay">
                    <h3 id="sceneTitle">åœºæ™¯æ ‡é¢˜</h3>
                    <p id="sceneText">åœºæ™¯æè¿°å†…å®¹...</p>
                    <div id="cantoneseText"></div>
                </div>
            </div>
            <div class="options-area" id="optionsArea"></div>
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-value" id="currentDay">å¹´å»¿å…«</div>
                    <div class="status-label" id="dayLabel">å½“å‰æ—¥æœŸ</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="luckValue">88</div>
                    <div class="status-label" id="luckLabel">å¥½è¿å€¼</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="moneyValue">Â¥100</div>
                    <div class="status-label" id="moneyLabel">åˆ©æ˜¯é’±</div>
                </div>
            </div>
        </div>
        
        <!-- ç»“å±€ç»“ç®—é¡µé¢ -->
        <div id="endingPage" class="page">
            <h2 id="endingTitle">ğŸŠ æ˜¥èŠ‚æ—…ç¨‹ç»“æŸ</h2>
            <img id="endingImage" alt="ç»“å±€å›¾ç‰‡">
            <div class="ending-content">
                <h3 id="endingResultTitle">æœ¬æ¬¡æ˜¥èŠ‚æˆå°±</h3>
                <p id="endingResultText">æ ¹æ®æ‚¨çš„é€‰æ‹©ï¼Œè·å¾—äº†ä»¥ä¸‹æˆå°±...</p>
                
                <div class="ending-stats" id="endingStats"></div>
                
                <div class="ending-type" id="endingTypeSection">
                    <div class="ending-type-title" id="endingTypeTitle">æ˜¥èŠ‚ç±»å‹</div>
                    <div class="ending-type-desc" id="endingTypeDesc">æ ¹æ®æ‚¨çš„é€‰æ‹©ç¡®å®šçš„æ˜¥èŠ‚ç±»å‹</div>
                </div>
                
                <div class="achievement-list" id="achievementList"></div>
                
                <p id="endingConclusion">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŠ½å–æ‚¨çš„æ–°å¹´å¥½è¿ç­¾ï¼</p>
            </div>
            <button id="drawFortuneBtn" class="ending-action-btn">âœ¨ æŠ½å–æˆ‘çš„æ–°å¹´ç­¾</button>
        </div>
        
        <!-- æ–°å¹´ç­¾é¡µé¢ -->
        <div id="fortunePage" class="page">
            <h2 id="fortuneTitle">é©¬å¹´å¥½è¿ç­¾</h2>
            <img id="fortuneImage" alt="å¥½è¿ç­¾å›¾ç‰‡">
            <div class="fortune-text">
                <p id="fortuneText">æ­£åœ¨æŠ½å–æ‚¨çš„æ–°å¹´å¥½è¿ç­¾...</p>
                <p id="fortuneEnglish"></p>
            </div>
            <button id="shareBtn" class="action-btn">åˆ†äº«å¥½è¿</button>
            <button id="retryBtn" class="action-btn">å†æŠ½ä¸€æ¬¡</button>
            <button id="homeBtn" class="action-btn">è¿”å›é¦–é¡µ</button>
            <div class="qrcode-section">
                <h4 id="qrcodeTitle">ğŸ“± åˆ†äº«æ¸¸æˆç»™æœ‹å‹</h4>
                <img id="qrcodeImg" alt="äºŒç»´ç ">
                <p id="qrcodeHint">æ‰«ç ä¸€èµ·ä½“éªŒå¹¿åºœå¹´å‘³ï¼</p>
            </div>
        </div>
    </div>

    <script>
        // ==================== æ¸¸æˆé…ç½® ====================
        const game = {
            language: 'zh',
            currentScene: 0,
            luck: 88,
            money: 100,
            happiness: 100,
            collectedItems: [],
            achievements: [],
            lastOptionResult: null,
            selectedOptions: [],
            choiceTypes: {
                traditional: 0,
                modern: 0,
                family: 0,
                social: 0
            }
        };
// ==================== BGM æ§åˆ¶ ====================
const bgmConfig = {
    audio: null,
    isMuted: false,
    isPlaying: false,
    userInteracted: false
};

// åˆå§‹åŒ– BGM
function initBGM() {
    bgmConfig.audio = document.getElementById('bgmAudio');
    const bgmBtn = document.getElementById('bgmToggle');
    
    if (!bgmConfig.audio || !bgmBtn) return;
    
    // è®¾ç½®åˆå§‹éŸ³é‡
    bgmConfig.audio.volume = 0.5;
    
    // å°è¯•è‡ªåŠ¨æ’­æ”¾
    const playPromise = bgmConfig.audio.play();
    
    if (playPromise !== undefined) {
        playPromise.then(() => {
            console.log('BGM è‡ªåŠ¨æ’­æ”¾æˆåŠŸ');
            bgmConfig.isPlaying = true;
            bgmConfig.userInteracted = true;
            bgmBtn.classList.remove('muted');
        }).catch(error => {
            console.log('BGM è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’:', error);
            // ç­‰å¾…ç”¨æˆ·ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®åæ’­æ”¾
            const startAudio = function() {
                if (!bgmConfig.isPlaying) {
                    bgmConfig.audio.play().then(() => {
                        bgmConfig.isPlaying = true;
                        bgmConfig.userInteracted = true;
                        bgmBtn.classList.remove('muted');
                        document.removeEventListener('click', startAudio);
                        document.removeEventListener('touchstart', startAudio);
                        console.log('ç”¨æˆ·äº¤äº’å BGM å¼€å§‹æ’­æ”¾');
                    }).catch(e => console.log('ä»ç„¶æ— æ³•æ’­æ”¾:', e));
                }
            };
            
            // ç›‘å¬ç”¨æˆ·äº¤äº’äº‹ä»¶
            document.addEventListener('click', startAudio, { once: true });
            document.addEventListener('touchstart', startAudio, { once: true });
        });
    }
    
    // BGM æŒ‰é’®ç‚¹å‡»äº‹ä»¶ - é™éŸ³/å–æ¶ˆé™éŸ³
    bgmBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        
        if (!bgmConfig.audio) return;
        
        if (bgmConfig.isMuted) {
            // å–æ¶ˆé™éŸ³
            bgmConfig.audio.muted = false;
            bgmConfig.isMuted = false;
            bgmBtn.classList.remove('muted');
            bgmBtn.innerHTML = 'ğŸµ';
            
            // å¦‚æœæ²¡åœ¨æ’­æ”¾ï¼Œå°è¯•æ’­æ”¾
            if (!bgmConfig.isPlaying) {
                bgmConfig.audio.play().then(() => {
                    bgmConfig.isPlaying = true;
                }).catch(e => console.log('æ’­æ”¾å¤±è´¥:', e));
            }
        } else {
            // é™éŸ³
            bgmConfig.audio.muted = true;
            bgmConfig.isMuted = true;
            bgmBtn.classList.add('muted');
            bgmBtn.innerHTML = 'ğŸ”‡';
        }
        
        console.log('BGM é™éŸ³çŠ¶æ€:', bgmConfig.isMuted);
    });
    
    // å¤„ç†é¡µé¢å¯è§æ€§å˜åŒ–ï¼ˆå½“ç”¨æˆ·åˆ‡æ¢æ ‡ç­¾é¡µå†å›æ¥æ—¶ç»§ç»­æ’­æ”¾ï¼‰
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden && bgmConfig.userInteracted && !bgmConfig.isMuted && !bgmConfig.isPlaying) {
            bgmConfig.audio.play().then(() => {
                bgmConfig.isPlaying = true;
            }).catch(e => console.log('æ¢å¤æ’­æ”¾å¤±è´¥:', e));
        }
    });
    
    // å¤„ç†é¡µé¢å¸è½½æ—¶æš‚åœ
    window.addEventListener('beforeunload', function() {
        if (bgmConfig.audio && bgmConfig.isPlaying) {
            bgmConfig.audio.pause();
        }
    });
}
       // ==================== å›¾ç‰‡é…ç½® ====================
        const gameImages = {
            languageBg: "images/å¼€å±å›¾å»æ°´å° (1).png",
            scenes: [
                "images/å¹´28æ‰“æ‰«å›¾å»æ°´å°.png",
                "images/å¹´30è¡ŒèŠ±è¡—å›¾å»æ°´å° (1).png", 
                "images/å¹´åˆä¸€å›¢å¹´é¥­å›¾å»æ°´å°.png",
                "images/å…ƒå®µèŠ‚é€—åˆ©æ˜¯å›¾å»æ°´å°.png"
            ],
            // é€‰é¡¹ç»“æœå›¾ç‰‡
            optionResults: [
                [
                    "images/æ“¦ç‰Œä½å»æ°´å°.png",      // ç¬¬ä¸€åœºæ™¯é€‰é¡¹1
                    "images/å»éœ‰è¿å»æ°´å°.png",       // ç¬¬ä¸€åœºæ™¯é€‰é¡¹2
                    "images/æ´—è¢«è¤¥å»æ°´å°.png"        // ç¬¬ä¸€åœºæ™¯é€‰é¡¹3
                ],
                [
                    "images/ä¹°æ¡ƒèŠ±å»æ°´å°.png",        // ç¬¬äºŒåœºæ™¯é€‰é¡¹1
                    "images/ä¹°å¹´æ¡”å»æ°´å°.png",        // ç¬¬äºŒåœºæ™¯é€‰é¡¹2
                    "images/æ¬£èµèŠ±å»æ°´å°.png"         // ç¬¬äºŒåœºæ™¯é€‰é¡¹3
                ],
                [
                    "images/æ‘†ç¢—ç­·å»æ°´å°.png",        // ç¬¬ä¸‰åœºæ™¯é€‰é¡¹1
                    "images/åŒ…æ²¹è§’å»æ°´å°.png",        // ç¬¬ä¸‰åœºæ™¯é€‰é¡¹2
                    "images/å¤‡ç›†èœå»æ°´å°.png"         // ç¬¬ä¸‰åœºæ™¯é€‰é¡¹3
                ],
                [
                    "images/ç»™åˆ©æ˜¯å»æ°´å°.png",        // ç¬¬å››åœºæ™¯é€‰é¡¹1
                    "images/åƒç‚¹å¿ƒå»æ°´å°.png",        // ç¬¬å››åœºæ™¯é€‰é¡¹2
                    "images/çœ‹èˆç‹®å»æ°´å°.png"         // ç¬¬å››åœºæ™¯é€‰é¡¹3
                ]
            ],
            // ç»“å±€å›¾ç‰‡
            endings: {
                wealth: "images/è´¢å¯Œç»“å±€å»æ°´å°.png",
                luck: "images/å¥½è¿ç»“å±€å»æ°´å°.png",
                happiness: "images/å¹¸ç¦ç»“å±€å»æ°´å°.png",
                perfect: "images/å®Œç¾ç»“å±€å»æ°´å°.png",
                traditional: "images/ä¼ ç»Ÿç»“å±€å»æ°´å°.png",
                social: "images/ç¤¾äº¤ç»“å±€å»æ°´å°.png",
                default: "images/æ™®é€šç»“å±€å›¾.png"
            },
            // æ–°å¹´ç­¾å›¾ç‰‡
            fortunes: [
                {
                    image: "images/æ–°å¹´ç­¾é©¬åˆ°æˆåŠŸå›¾å»æ°´å°.png",
                    text: {
                        zh: "é©¬åˆ°æˆåŠŸï¼Œäº‹ä¸šè…¾é£ï¼æ–°ä¸€å¹´å¦‚éªé©¬å¥”è…¾ï¼Œå‹‡å¾€ç›´å‰ï¼Œæ‰€æœ‰ç›®æ ‡éƒ½èƒ½é¡ºåˆ©è¾¾æˆï¼",
                        en: "Success comes with the horse! May your career soar like a galloping steed!"
                    }
                },
                {
                    image: "images/æ–°å¹´ç­¾è´¢è¿äº¨é€šå›¾å»æ°´å° (1).png",
                    text: {
                        zh: "è´¢è¿äº¨é€šï¼Œåˆ©æ˜¯å¤šå¤šï¼æ­£è´¢åè´¢ä¸€é½æ¥ï¼Œé“¶è¡Œå­˜æ¬¾èŠ‚èŠ‚é«˜ï¼",
                        en: "Wealth flows freely! May prosperity find you from all directions!"
                    }
                },
                {
                    image: "images/æ–°å¹´ç­¾æ¡ƒèŠ±ç››å¼€å›¾å»æ°´å°.png",
                    text: {
                        zh: "æ¡ƒèŠ±ç››å¼€ï¼Œå§»ç¼˜ç¾æ»¡ï¼å•èº«é‡è‰¯ç¼˜ï¼Œæœ‰æƒ…äººç»ˆæˆçœ·å±ï¼",
                        en: "Love blossoms! May you find your perfect match or deepen existing bonds!"
                    }
                },
                {
                    image: "images/æ–°å¹´ç­¾å®¶åº­å’Œç¦å›¾å»æ°´å°.png",
                    text: {
                        zh: "å®¶åº­å’Œç¦ï¼Œå¹¸ç¦å®‰åº·ï¼å®¶äººå¥åº·å¿«ä¹ï¼Œå›¢åœ†ç¾æ»¡ï¼",
                        en: "Family harmony and good health! May your home be filled with joy!"
                    }
                }
            ],
            qrcode: "images/åˆ†äº«äºŒç»´ç .png"
        };

      // ==================== æ¸¸æˆæ•°æ® ====================
const gameData = {
    zh: {
        languageTitle: "å¹¿åºœå¹´å‘³ä¹‹æ—…",
        languageSubtitle: "ä½“éªŒå¹¿ä¸œæ˜¥èŠ‚ä¼ ç»Ÿä¹ ä¿—",
        days: ["å¹´å»¿å…«", "å¹´ä¸‰å", "å¹´åˆä¸€", "å…ƒå®µèŠ‚"],
        dayLabel: "å½“å‰æ—¥æœŸ",
        luckLabel: "å¥½è¿å€¼", 
        moneyLabel: "åˆ©æ˜¯é’±",
        endingTitle: "ğŸŠ æ˜¥èŠ‚æ—…ç¨‹ç»“æŸ",
        fortuneTitle: "é©¬å¹´å¥½è¿ç­¾",
        shareText: "åˆ†äº«å¥½è¿",
        retryText: "å†æŠ½ä¸€æ¬¡",
        homeText: "è¿”å›é¦–é¡µ",
        qrcodeTitle: "ğŸ“± åˆ†äº«æ¸¸æˆç»™æœ‹å‹",
        qrcodeHint: "æ‰«ç ä¸€èµ·ä½“éªŒå¹¿åºœå¹´å‘³ï¼",
        scenes: [
            {
                title: "ğŸ§¹ æ´—é‚‹é¢è¿æ–°æ˜¥",
                text: "å¹´å»¿å…«çš„é˜³å…‰é€è¿‡æ»¡æ´²çª—ï¼Œæ´’åœ¨è¥¿å…³å¤§å±‹çš„é’ç –å¢™ä¸Šã€‚ä»Šå¤©æ˜¯'æ´—é‚‹é¢'çš„æ—¥å­ï¼Œè¦æŠŠå®¶é‡Œæ‰“æ‰«å¾—å¹²å¹²å‡€å‡€è¿æ–°å¹´ã€‚å¦ˆå¦ˆç»™äº†ä½ 100å…ƒé›¶èŠ±é’±ã€‚",
                cantonese: "é˜¿å¦ˆè¯ï¼šå¹´å»¿å…«ï¼Œæ´—é‚‹é¢ï¼Œæ´—åŸ‹è¡°æ°”å¥½è¿æ¥ï¼",
                options: [
                    { 
                        text: "ğŸ§¹ å¸®å¿™æ‰“æ‰«ç¥å°", 
                        result: "è®¤çœŸæ“¦æ‹­ç¥–å…ˆç‰Œä½ï¼Œçˆ¸çˆ¸èµèµç»™äº†20å…ƒåˆ©æ˜¯",
                        luck: 10, 
                        happiness: 5,
                        money: 20,
                        collect: "ğŸ§§ é•¿è¾ˆçš„èµèµ",
                        type: "ä¼ ç»Ÿ",
                        choiceType: "traditional",
                        imageIndex: 0
                    },
                    { 
                        text: "ğŸƒ ç”¨æŸšå¶æ°´æŠ¹é—¨çª—", 
                        result: "æŸšå¶æ¸…é¦™æ»¡å±‹ï¼Œé©±é™¤éœ‰è¿ï¼Œäº²æˆšç»™äº†30å…ƒåˆ©æ˜¯",
                        luck: 15,
                        money: 30,
                        collect: "ğŸƒ å‰ç¥¥æŸšå¶",
                        type: "ä¼ ç»Ÿ",
                        choiceType: "traditional",
                        imageIndex: 1
                    },
                    { 
                        text: "ğŸ§º æ¸…æ´—åºŠå•è¢«è¤¥", 
                        result: "å°†å…¨å®¶çš„åºŠå•è¢«è¤¥æ´—å¹²å‡€ï¼Œé˜³å…‰æ™’å¾—æš–æš–çš„ï¼Œå¦ˆå¦ˆç»™äº†20å…ƒé›¶èŠ±é’±",
                        happiness: 15,
                        money: 20,
                        collect: "ğŸ§º å¹²å‡€è¢«è¤¥",
                        type: "å®¶åŠ¡",
                        choiceType: "family",
                        imageIndex: 2
                    }
                ]
            },
            {
                title: "ğŸ® è¡ŒèŠ±è¡—ä¹°å¹´èŠ±",
                text: "å‚æ™šçš„èŠ±å¸‚äººæ½®æ¶ŒåŠ¨ï¼Œéœ“è™¹ç¯æ˜ ç…§ç€å„è‰²å¹´èŠ±ã€‚ç©ºæ°”ä¸­å¼¥æ¼«ç€æ¡ƒèŠ±é¦™å’Œå¹´æ¡”çš„æ¸…æ–°æ°”æ¯ã€‚",
                cantonese: "è¡ŒèŠ±è¡—ï¼Œè½¬å¤§è¿ï¼ä¹°æ”¯æ¡ƒèŠ±æ—ºå§»ç¼˜ï¼",
                options: [
                    { 
                        text: "ğŸŒ¸ ä¹°ä¸€æ ªæ¡ƒèŠ± ", 
                        result: "èŠ±å†œè¯´ï¼šåç”Ÿä»”ï¼Œä»Šå¹´è¡Œæ¡ƒèŠ±è¿å•¦ï¼",
                        luck: 20, 
                        money: -30,
                        happiness: 10,
                        collect: "ğŸŒ¸ æ¡ƒèŠ±æ",
                        type: "æµªæ¼«",
                        choiceType: "modern",
                        imageIndex: 0
                    },
                    { 
                        text: "ğŸŠ ä¹°ç›†å¹´æ¡” ", 
                        result: "é‡‘æ¡”æ»¡æå¤´ï¼Œå¯“æ„å¤§å‰å¤§åˆ©",
                        luck: 15, 
                        money: -15,
                        happiness: 5,
                        collect: "ğŸŠ é‡‘æ¡”æ ‘",
                        type: "è´¢å¯Œ",
                        choiceType: "traditional",
                        imageIndex: 1
                    },
                    { 
                        text: "ğŸš¶ åªçœ‹ä¸ä¹°ï¼Œæ„Ÿå—æ°”æ°›", 
                        result: "åœ¨èŠ±å¸‚é‡Œé—²é€›ï¼Œé‡è§é‚»å±…ç»™äº†ä½ ä¸€ä¸ªå°çº¢åŒ…",
                        happiness: 10,
                        money: 15,
                        collect: "ğŸ“¸ èŠ±å¸‚å›å¿†",
                        type: "ä½“éªŒ",
                        choiceType: "social",
                        imageIndex: 2
                    }
                ]
            },
            {
                title: "ğŸ¥˜ å›¢å¹´é¥­ç››å®´",
                text: "å…¨å®¶äººå›´åä¸€å ‚ï¼Œæ¡Œä¸Šæ‘†æ»¡äº†å¹¿åºœç‰¹è‰²å¹´èœï¼šç™½åˆ‡é¸¡ã€çƒ§é¹…ã€å‘èœèšè±‰ã€æ¸…è’¸é±¼...é˜¿å«²æ­£åœ¨ç››è€ç«é“æ±¤ã€‚",
                cantonese: "é˜¿å«²è¯ï¼šé¥®å•–æ±¤å…ˆï¼Œå¥½è¶³æ–™å˜ï¼",
                options: [
                    { 
                        text: "ğŸ¥¢ å¸®å¿™æ‘†ç¢—ç­·", 
                        result: "æŒ‰ç…§é•¿å¹¼é¡ºåºæ‘†å¥½ç¢—ç­·ï¼Œé˜¿å…¬ç‚¹å¤´èµè®¸ç»™äº†åˆ©æ˜¯",
                        luck: 5, 
                        happiness: 8,
                        money: 50,
                        collect: "ğŸ¥¢ ä¼ ç»Ÿé¤å…·",
                        type: "ä¼ ç»Ÿ",
                        choiceType: "family",
                        imageIndex: 0
                    },
                    { 
                        text: "ğŸ å­¦åŒ…æ²¹è§’", 
                        result: "é˜¿å¦ˆæ•™ä½ åŒ…æ²¹è§’ï¼Œè¿˜ç»™äº†é›¶èŠ±é’±",
                        happiness: 15,
                        money: 30,
                        collect: "ğŸ¥Ÿ è‡ªåˆ¶æ²¹è§’",
                        type: "ç¾é£Ÿ",
                        choiceType: "family",
                        imageIndex: 1
                    },
                    { 
                        text: "ğŸ² å¸®å¿™å‡†å¤‡ç›†èœ", 
                        result: "å°†é²é±¼ã€é¹…æŒã€èŠ±è‡ç­‰é£Ÿæä¸€å±‚å±‚é“ºå¥½ï¼Œäº²æˆšç»™äº†èµèµçº¢åŒ…",
                        luck: 10,
                        money: 40,
                        collect: "ğŸ² ç›†èœåˆ¶ä½œç»éªŒ",
                        type: "ç¾é£Ÿ",
                        choiceType: "traditional",
                        imageIndex: 2
                    }
                ]
            },
            {
                title: "ğŸ§§ æ‹œå¹´é€—åˆ©æ˜¯",
                text: "ç©¿ä¸Šå…¨æ–°çš„å”è£…è¡«è£¤ï¼Œå‡†å¤‡å‡ºé—¨æ‹œå¹´ã€‚é˜¿çˆ¸é€’ç»™ä½ ä¸€å åˆ©æ˜¯å°ï¼šè§åˆ°é•¿è¾ˆè¦è®²æ­å–œå‘è´¢å•Šï¼",
                cantonese: "ç»†è·¯ä»”æœ€å¼€å¿ƒå°±ç³»é€—åˆ©æ˜¯å•¦ï¼",
                options: [
                    { 
                        text: "ğŸ¡ å»é˜¿å…¬é˜¿å«²å®¶æ‹œå¹´", 
                        result: "é˜¿å…¬ç»™ä½ å¤§åˆ©æ˜¯ï¼Œè¿˜å‡†å¤‡äº†ç“œå­ç³–æœ",
                        money: 200, 
                        happiness: 10,
                        collect: "ğŸ§§ å¤§çº¢åŒ…",
                        type: "å®¶åº­",
                        choiceType: "family",
                        imageIndex: 0
                    },
                    { 
                        text: "ğŸ® è·Ÿçˆ¸å¦ˆå»èŒ¶æ¥¼", 
                        result: "èŒ¶æ¥¼äººå£°é¼æ²¸ï¼Œä¸€ç›…ä¸¤ä»¶ï¼Œé‡åˆ°äº²æˆšç»™äº†åˆ©æ˜¯",
                        money: 100, 
                        happiness: 15,
                        collect: "ğŸµ èŒ¶æ¥¼ç‚¹å¿ƒåˆ¸",
                        type: "ç¤¾äº¤",
                        choiceType: "social",
                        imageIndex: 1
                    },
                    { 
                        text: "ğŸ¦ çœ‹èˆç‹®è¡¨æ¼”", 
                        result: "é”£é¼“å–§å¤©ï¼Œé†’ç‹®é‡‡é’ï¼Œè¡¨æ¼”è€…ç»™äº†å°çº¢åŒ…",
                        luck: 20, 
                        happiness: 20,
                        money: 80,
                        collect: "ğŸ¦ èˆç‹®çºªå¿µç« ",
                        type: "æ–‡åŒ–",
                        choiceType: "social",
                        imageIndex: 2
                    }
                ]
            }
        ],
        endings: [
            {
                title: "ğŸ® ä¼ ç»Ÿæ¸©é¦¨å‹",
                desc: "æ‚¨é€‰æ‹©äº†ä¼ ç»Ÿçš„æ˜¥èŠ‚ä¹ ä¿—ï¼Œæ³¨é‡å®¶åº­å›¢èšå’Œä¼ ç»Ÿä»ªå¼ã€‚æ‚¨çš„æ˜¥èŠ‚å……æ»¡äº†æ¸©é¦¨çš„å®¶åº­æ°›å›´å’Œæµ“éƒçš„ä¼ ç»Ÿæ°”æ¯ã€‚",
                condition: (game) => game.choiceTypes.traditional >= 2 && game.choiceTypes.family >= 2,
                imageType: "traditional"
            },
            {
                title: "ğŸ’° è´¢è¿äº¨é€šå‹",
                desc: "æ‚¨çš„æ˜¥èŠ‚è´¢è¿äº¨é€šï¼ä¸ä»…æ”¶åˆ°äº†ä¸°åšçš„åˆ©æ˜¯é’±ï¼Œè¿˜åšå‡ºäº†æ˜æ™ºçš„é€‰æ‹©ã€‚æ–°çš„ä¸€å¹´å¿…å°†è´¢æºå¹¿è¿›ï¼",
                condition: (game) => game.money >= 300,
                imageType: "wealth"
            },
            {
                title: "âœ¨ å¥½è¿è¿è¿å‹",
                desc: "å¥½è¿ä¼´éšæ‚¨çš„æ•´ä¸ªæ˜¥èŠ‚ï¼æ‚¨çš„é€‰æ‹©å¸¦æ¥äº†æ»¡æ»¡çš„å¥½è¿å€¼ï¼Œæ–°çš„ä¸€å¹´å¿…å°†ä¸€å¸†é£é¡ºï¼Œå¿ƒæƒ³äº‹æˆï¼",
                condition: (game) => game.luck >= 140,
                imageType: "luck"
            },
            {
                title: "ğŸ‰ ç¤¾äº¤è¾¾äººå‹",
                desc: "æ‚¨ç§¯æå‚ä¸å„ç§ç¤¾äº¤æ´»åŠ¨ï¼Œä½“éªŒäº†ä¸°å¯Œå¤šå½©çš„æ˜¥èŠ‚æ°›å›´ã€‚æ‚¨çš„æ˜¥èŠ‚å……æ»¡äº†æ¬¢ä¹å’Œäººæ°”ï¼",
                condition: (game) => game.choiceTypes.social >= 2,
                imageType: "social"
            },
            {
                title: "ğŸ˜Š å¹¸ç¦ç¾æ»¡å‹",
                desc: "æ‚¨çš„æ˜¥èŠ‚å¹¸ç¦åº¦çˆ†æ£šï¼å®¶äººå›¢èšã€ç¾é£Ÿç›¸ä¼´ã€å¿«ä¹æ— é™ï¼Œè¿™æ˜¯æœ€å®Œç¾çš„æ˜¥èŠ‚ä½“éªŒï¼",
                condition: (game) => game.happiness >= 140,
                imageType: "happiness"
            },
            {
                title: "ğŸ¨ å¤šæ ·ä½“éªŒå‹",
                desc: "æ‚¨å°è¯•äº†å„ç§ä¸åŒçš„æ˜¥èŠ‚ä½“éªŒï¼Œæ—¢æœ‰ä¼ ç»Ÿä¹ ä¿—ï¼Œåˆæœ‰ç°ä»£å…ƒç´ ã€‚æ‚¨çš„æ˜¥èŠ‚ä¸°å¯Œå¤šå½©ï¼",
                condition: (game) => {
                    const types = Object.values(game.choiceTypes).filter(count => count > 0);
                    return types.length >= 3;
                },
                imageType: "perfect"
            }
        ],
        achievements: [
            { 
                id: 1, 
                name: "ğŸ§¹ ä¼ ç»Ÿå®ˆæŠ¤è€…", 
                desc: "æ‚¨æªå®ˆä¼ ç»Ÿï¼Œé€‰æ‹©äº†å¤šä¸ªä¼ ç»Ÿä¹ ä¿—",
                icon: "ğŸ®",
                condition: (game) => game.choiceTypes.traditional >= 2
            },
            { 
                id: 2, 
                name: "ğŸŒ¸ æµªæ¼«ä¸»ä¹‰è€…", 
                desc: "æ‚¨é€‰æ‹©äº†æ¡ƒèŠ±ï¼ŒæœŸå¾…ç¾å¥½å§»ç¼˜",
                icon: "ğŸ’•",
                condition: (game) => game.selectedOptions.includes('ä¹°ä¸€æ ªæ¡ƒèŠ±')
            },
            { 
                id: 3, 
                name: "ğŸ’° è´¢å¯Œè¿½æ±‚è€…", 
                desc: "æ‚¨è·å¾—äº†ä¸°åšåˆ©æ˜¯ï¼Œè´¢è¿äº¨é€š",
                icon: "ğŸ’°",
                condition: (game) => game.money >= 250
            },
            { 
                id: 4, 
                name: "ğŸ¯ å…¨èƒ½ä½“éªŒå®¶", 
                desc: "æ‚¨å°è¯•äº†å¤šç§ä¸åŒçš„æ˜¥èŠ‚ä½“éªŒ",
                icon: "ğŸ¨",
                condition: (game) => game.collectedItems.length >= 4
            },
            { 
                id: 5, 
                name: "âœ¨ å¥½è¿ä¹‹æ˜Ÿ", 
                desc: "æ‚¨çš„å¥½è¿å€¼çˆ†æ£šï¼Œæ–°å¹´å¿…å®šé¡ºåˆ©",
                icon: "â­",
                condition: (game) => game.luck >= 130
            },
            { 
                id: 6, 
                name: "ğŸ‰ å¹¸ç¦è¾¾äºº", 
                desc: "æ‚¨çš„å¹¸ç¦åº¦æ»¡æ»¡ï¼Œæ˜¥èŠ‚å¿«ä¹æ— æ¯”",
                icon: "ğŸ˜Š",
                condition: (game) => game.happiness >= 130
            },
            { 
                id: 7, 
                name: "ğŸ² ç¾é£Ÿé‰´èµå®¶", 
                desc: "æ‚¨å‚ä¸äº†å¤šç§ç¾é£Ÿåˆ¶ä½œï¼Œå“å‘³æ˜¥èŠ‚",
                icon: "ğŸœ",
                condition: (game) => {
                    const foodItems = ['è‡ªåˆ¶æ²¹è§’', 'ç›†èœåˆ¶ä½œç»éªŒ', 'èŒ¶æ¥¼ç‚¹å¿ƒåˆ¸'];
                    return game.collectedItems.filter(item => foodItems.includes(item)).length >= 2;
                }
            },
            { 
                id: 8, 
                name: "ğŸ¡ å®¶åº­æ¸©é¦¨å‹", 
                desc: "æ‚¨æ³¨é‡å®¶åº­å›¢èšï¼Œäº«å—å¤©ä¼¦ä¹‹ä¹",
                icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",
                condition: (game) => game.choiceTypes.family >= 2
            }
        ]
    },
    en: {
        languageTitle: "Guangdong New Year Journey",
        languageSubtitle: "Experience the Cantonese-style New Year Traditions",
        days: ["Feb 15", "New Year's Eve", "New Year's Day", "Lantern Festival"],
        dayLabel: "Current Day",
        luckLabel: "Luck Points", 
        moneyLabel: "Red Packets",
        endingTitle: "ğŸŠ Journey Complete",
        fortuneTitle: "Year of the Horse Fortune",
        shareText: "Share Fortune",
        retryText: "Draw Again",
        homeText: "Back to Home",
        qrcodeTitle: "ğŸ“± Share with Friends",
        qrcodeHint: "Scan QR code to play together!",
        scenes: [
            {
                title: "ğŸ§¹ Spring Cleaning Day",
                text: "Morning sunlight shines through the traditional windows. It's time for thorough cleaning to welcome the New Year! Mom gives you Â¥100 pocket money.",
                cantonese: "",
                options: [
                    { 
                        text: "ğŸ§¹ Clean the altar", 
                        result: "Earn praise from elders for cleaning carefully, dad gives Â¥20 red packet",
                        luck: 10, 
                        happiness: 5,
                        money: 20,
                        collect: "ğŸ§§ Elders' Praise",
                        type: "traditional",
                        choiceType: "traditional",
                        imageIndex: 0
                    },
                    { 
                        text: "ğŸƒ Wipe with pomelo leaves", 
                        result: "Fresh scent fills the room, driving away bad luck, relative gives Â¥30 red packet",
                        luck: 15,
                        money: 30,
                        collect: "ğŸƒ Lucky Pomelo Leaves",
                        type: "traditional",
                        choiceType: "traditional",
                        imageIndex: 1
                    },
                    { 
                        text: "ğŸ§º Wash bed linens", 
                        result: "Wash all family bed linens, sun-dried and warm, mom gives Â¥20 pocket money",
                        happiness: 15,
                        money: 20,
                        collect: "ğŸ§º Clean Bed Linens",
                        type: "housework",
                        choiceType: "family",
                        imageIndex: 2
                    }
                ]
            },
            {
                title: "ğŸ® Flower Market Visit",
                text: "The flower market is bustling with people under neon lights. Scents of peach blossoms fill the air.",
                cantonese: "",
                options: [
                    { 
                        text: "ğŸŒ¸ Buy peach blossoms", 
                        result: "The florist smiles: Good luck in love this year!",
                        luck: 20, 
                        money: -30,
                        happiness: 10,
                        collect: "ğŸŒ¸ Peach Blossom Branch",
                        type: "romantic",
                        choiceType: "modern",
                        imageIndex: 0
                    },
                    { 
                        text: "ğŸŠ Buy a kumquat tree", 
                        result: "Golden fruits symbolize prosperity and good fortune",
                        luck: 15, 
                        money: -15,
                        happiness: 5,
                        collect: "ğŸŠ Kumquat Tree",
                        type: "wealth",
                        choiceType: "traditional",
                        imageIndex: 1
                    },
                    { 
                        text: "ğŸš¶ Just enjoy the atmosphere", 
                        result: "Wander through the market, meeting neighbors who give small red packets",
                        happiness: 10,
                        money: 15,
                        collect: "ğŸ“¸ Market Memories",
                        type: "experience",
                        choiceType: "social",
                        imageIndex: 2
                    }
                ]
            },
            {
                title: "ğŸ¥˜ Reunion Dinner Feast",
                text: "The whole family gathers around a table filled with Cantonese dishes for the New Year: white cut chicken, roast goose, dried oyster with black moss, steamed fish... Grandma serves hot soup.",
                cantonese: "",
                options: [
                    { 
                        text: "ğŸ¥¢ Set the table", 
                        result: "Arrange dishes properly, earning approval from elders who give red packet",
                        luck: 5, 
                        happiness: 8,
                        money: 50,
                        collect: "ğŸ¥¢ Traditional Tableware",
                        type: "traditional",
                        choiceType: "family",
                        imageIndex: 0
                    },
                    { 
                        text: "ğŸ Learn to make Yau Gok (Crispy Pastry Dumpling)", 
                        result: "Mom teaches you traditional recipes and gives you pocket money",
                        happiness: 15,
                        money: 30,
                        collect: "ğŸ¥Ÿ Homemade Yau Gok (Crispy Pastry Dumpling)",
                        type: "food",
                        choiceType: "family",
                        imageIndex: 1
                    },
                    { 
                        text: "ğŸ² Prepare Poon Choi (Big Bowl Feast)", 
                        result: "Layer abalone, mushrooms and other ingredients, relative gives appreciation red packet",
                        luck: 10,
                        money: 40,
                        collect: "ğŸ² Poon Choi (Big Bowl Feast) Experience",
                        type: "food",
                        choiceType: "traditional",
                        imageIndex: 2
                    }
                ]
            },
            {
                title: "ğŸ§§ Red Packet Day",
                text: "Wearing brand new traditional Tang suit, ready to pay New Year visits. Dad hands you a stack of red packets: Remember to say 'Gong Hei Fat Choy' when you see elders!",
                cantonese: "",
                options: [
                    { 
                        text: "ğŸ¡ Visit grandparents", 
                        result: "Receive big red packets with blessings",
                        money: 200, 
                        happiness: 10,
                        collect: "ğŸ§§ Big Red Packet",
                        type: "family",
                        choiceType: "family",
                        imageIndex: 0
                    },
                    { 
                        text: "ğŸ® Go to the tea house", 
                        result: "Experience a festive atmosphere with family, meet relatives who give red packets",
                        money: 100, 
                        happiness: 15,
                        collect: "ğŸµ Tea House Voucher",
                        type: "social",
                        choiceType: "social",
                        imageIndex: 1
                    },
                    { 
                        text: "ğŸ¦ Watch lion dance", 
                        result: "Exciting performance with drums and colors, the performers give small red packets",
                        luck: 20, 
                        happiness: 20,
                        money: 80,
                        collect: "ğŸ¦ Lion Dance Badge",
                        type: "cultural",
                        choiceType: "social",
                        imageIndex: 2
                    }
                ]
            }
        ],
        endings: [
            {
                title: "ğŸ® Traditional & Warm",
                desc: "You followed traditional Chinese New Year customs, focusing on family reunions. Your celebration was filled with warmth and tradition.",
                condition: (game) => game.choiceTypes.traditional >= 2 && game.choiceTypes.family >= 2,
                imageType: "traditional"
            },
            {
                title: "ğŸ’° Wealth & Prosperity",
                desc: "Your New Year brings great wealth! You received generous red packets and made wise choices. Prosperity awaits!",
                condition: (game) => game.money >= 300,
                imageType: "wealth"
            },
            {
                title: "âœ¨ Lucky & Fortunate",
                desc: "Good luck with your whole celebration! Your choices brought high luck points for a smooth year ahead.",
                condition: (game) => game.luck >= 140,
                imageType: "luck"
            },
            {
                title: "ğŸ‰ Social Butterfly",
                desc: "You actively participated in social activities, experiencing  a diverse festive atmosphere. Your New Year was joyful!",
                condition: (game) => game.choiceTypes.social >= 2,
                imageType: "social"
            },
            {
                title: "ğŸ˜Š Happy & Joy",
                desc: "Your happiness overflowed! Family gatherings, delicious food, and endless joy made a perfect celebration.",
                condition: (game) => game.happiness >= 140,
                imageType: "happiness"
            },
            {
                title: "ğŸ¨ Diverse Experience",
                desc: "You tried various Chinese New Year experiences, blending tradition with modernity. Your celebration was rich and colorful!",
                condition: (game) => {
                    const types = Object.values(game.choiceTypes).filter(count => count > 0);
                    return types.length >= 3;
                },
                imageType: "perfect"
            }
        ],
        achievements: [
            { 
                id: 1, 
                name: "ğŸ§¹ Tradition Keeper", 
                desc: "You followed multiple traditional customs",
                icon: "ğŸ®",
                condition: (game) => game.choiceTypes.traditional >= 2
            },
            { 
                id: 2, 
                name: "ğŸŒ¸ Romantic Soul", 
                desc: "You chose peach blossoms for love luck",
                icon: "ğŸ’•",
                condition: (game) => game.selectedOptions.includes('Buy peach blossoms')
            },
            { 
                id: 3, 
                name: "ğŸ’° Wealth Seeker", 
                desc: "You received generous red packets",
                icon: "ğŸ’°",
                condition: (game) => game.money >= 250
            },
            { 
                id: 4, 
                name: "ğŸ¯ All-Round Experiencer", 
                desc: "You tried various Chinese New Year experiences",
                icon: "ğŸ¨",
                condition: (game) => game.collectedItems.length >= 4
            },
            { 
                id: 5, 
                name: "âœ¨ Lucky Star", 
                desc: "You have exceptional luck for the New Year",
                icon: "â­",
                condition: (game) => game.luck >= 130
            },
            { 
                id: 6, 
                name: "ğŸ‰ Happiness Master", 
                desc: "You experienced great joy this New Year",
                icon: "ğŸ˜Š",
                condition: (game) => game.happiness >= 130
            },
            { 
                id: 7, 
                name: "ğŸ² Food Connoisseur", 
                desc: "You participated in various food preparations",
                icon: "ğŸœ",
                condition: (game) => {
                    const foodItems = ['Homemade Yau Gok', 'Poon Choi Experience', 'Teahouse Voucher'];
                    return game.collectedItems.filter(item => foodItems.includes(item)).length >= 2;
                }
            },
            { 
                id: 8, 
                name: "ğŸ¡ Family Oriented", 
                desc: "You focused on family gatherings and bonding",
                icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",
                condition: (game) => game.choiceTypes.family >= 2
            }
        ]
    }
};
        
// ==================== åˆå§‹åŒ– ====================
function init() {
    console.log("æ¸¸æˆåˆå§‹åŒ–...");
    
    const bgWrapper = document.getElementById('bgWrapper');
    const bgImg = document.getElementById('bgImage');
    const languagePage = document.getElementById('languagePage');
    
    // å¼ºåˆ¶è®¾ç½®çˆ¶å®¹å™¨ä¸ºç›¸å¯¹å®šä½ï¼ˆç¡®ä¿ç»å¯¹å®šä½ç”Ÿæ•ˆï¼‰
    languagePage.style.position = 'relative';
    
    // è®¾ç½®èƒŒæ™¯å›¾æº
    bgImg.src = gameImages.languageBg;
    
    // å›¾ç‰‡åŠ è½½æˆåŠŸ - å¼ºåˆ¶è¦†ç›–ï¼Œä¸åšä»»ä½•è‡ªé€‚åº”è°ƒæ•´
    bgImg.onload = function() {
        bgWrapper.classList.remove('bg-fallback');
        bgImg.style.display = 'block';
        
        // å¼ºåˆ¶æ ·å¼ï¼Œç¡®ä¿è¦†ç›–
        bgWrapper.style.height = '100%';
        bgWrapper.style.width = '100%';
        bgImg.style.height = '100%';
        bgImg.style.width = '100%';
        bgImg.style.objectFit = 'cover';
        bgImg.style.objectPosition = 'center';
        
        console.log("èƒŒæ™¯å›¾åŠ è½½æˆåŠŸï¼Œå¼ºåˆ¶100%è¦†ç›–");
    };
    
    // å›¾ç‰‡åŠ è½½å¤±è´¥
    bgImg.onerror = function() {
        console.log("èƒŒæ™¯å›¾åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨çº¯è‰²çº¹ç†èƒŒæ™¯");
        bgWrapper.classList.add('bg-fallback');
        bgImg.style.display = 'none';
        
        // å¼ºåˆ¶å¤‡ç”¨èƒŒæ™¯é«˜åº¦
        bgWrapper.style.height = '100%';
        bgWrapper.style.width = '100%';
    };
    
    // è¶…æ—¶ä¿æŠ¤ - åªå¤„ç†å¤±è´¥æƒ…å†µï¼Œä¸å¹²æ‰°é«˜åº¦
    setTimeout(() => {
        if (!bgImg.complete || bgImg.naturalHeight === 0) {
            bgWrapper.classList.add('bg-fallback');
            bgImg.style.display = 'none';
            bgWrapper.style.height = '100%';
            bgWrapper.style.width = '100%';
            console.log("èƒŒæ™¯å›¾è¶…æ—¶ï¼Œå¯ç”¨å¤‡ç”¨æ ·å¼");
        }
        
        // æ¯æ¬¡é¡µé¢åŠ è½½éƒ½å¼ºåˆ¶æ£€æŸ¥å¹¶ä¿®æ­£æ ·å¼ï¼ˆç»ˆæä¿é™©ï¼‰
        const enforceBackground = function() {
            if (bgWrapper) {
                bgWrapper.style.height = '100%';
                bgWrapper.style.width = '100%';
            }
            if (bgImg && bgImg.style.display !== 'none') {
                bgImg.style.height = '100%';
                bgImg.style.width = '100%';
                bgImg.style.objectFit = 'cover';
                bgImg.style.objectPosition = 'center';
            }
        };
        
        // ç«‹å³æ‰§è¡Œä¸€æ¬¡
        enforceBackground();
        
        // å»¶è¿Ÿå†æ‰§è¡Œå‡ æ¬¡ï¼ˆåº”å¯¹ç§»åŠ¨ç«¯æ¸²æŸ“å»¶è¿Ÿï¼‰
        setTimeout(enforceBackground, 100);
        setTimeout(enforceBackground, 300);
        setTimeout(enforceBackground, 500);
        
        // ç›‘å¬æ»šåŠ¨å’Œè§¦æ‘¸äº‹ä»¶ï¼ŒæŒç»­ä¿è¯èƒŒæ™¯è¦†ç›–
        languagePage.addEventListener('scroll', enforceBackground);
        languagePage.addEventListener('touchmove', enforceBackground);
        languagePage.addEventListener('touchend', enforceBackground);
        
        // ç›‘å¬çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', function() {
            enforceBackground();
            setTimeout(enforceBackground, 100);
        });
        
    }, 300);
    
    // å…¶ä»–åˆå§‹åŒ–ä»£ç ä¿æŒä¸å˜...
    const qrImg = document.getElementById('qrcodeImg');
    qrImg.src = gameImages.qrcode;
    qrImg.onerror = function() {
        console.log("äºŒç»´ç åŠ è½½å¤±è´¥");
        qrImg.parentNode.innerHTML = '<div style="font-size: 60px; color: #c1272d; text-align:center;">ğŸ“±</div>';
    };
    
    document.getElementById('chineseBtn').addEventListener('click', function() {
        startGame('zh');
    });
    
    document.getElementById('englishBtn').addEventListener('click', function() {
        startGame('en');
    });
    
    document.getElementById('rulesBtn').addEventListener('click', function() {
        document.getElementById('rulesModal').classList.add('active');
    });
    
    document.getElementById('rulesClose').addEventListener('click', function() {
        document.getElementById('rulesModal').classList.remove('active');
    });
    
    document.getElementById('shareBtn').addEventListener('click', shareFortune);
    document.getElementById('retryBtn').addEventListener('click', drawFortune);
    document.getElementById('homeBtn').addEventListener('click', backToHome);
    document.getElementById('drawFortuneBtn').addEventListener('click', showFortunePage);
    
    document.getElementById('polaroidModal').addEventListener('click', function() {
        this.classList.remove('active');
    });
    // åˆå§‹åŒ– BGM
initBGM();
    console.log("åˆå§‹åŒ–å®Œæˆ - èƒŒæ™¯å›¾å¼ºåˆ¶è¦†ç›–æ¨¡å¼å·²å¯ç”¨");
}

        // ==================== å¼€å§‹æ¸¸æˆ ====================
        function startGame(lang) {
            console.log("å¼€å§‹æ¸¸æˆï¼Œè¯­è¨€:", lang);
            game.language = lang;
            game.currentScene = 0;
            game.luck = 88;
            game.money = 100;
            game.happiness = 100;
            game.collectedItems = [];
            game.achievements = [];
            game.selectedOptions = [];
            game.choiceTypes = { traditional: 0, modern: 0, family: 0, social: 0 };
            
            updateLanguageUI();
            
            document.getElementById('languagePage').classList.remove('active');
            document.getElementById('gamePage').classList.add('active');
            document.getElementById('endingPage').classList.remove('active');
            document.getElementById('fortunePage').classList.remove('active');
            
            loadScene();
            // ç¡®ä¿ BGM æŒ‰é’®åœ¨æ¸¸æˆé¡µé¢ä»ç„¶å¯è§
const bgmBtn = document.getElementById('bgmToggle');
if (bgmBtn) {
    bgmBtn.style.zIndex = '1000';
}
        }

        // ==================== æ›´æ–°ç•Œé¢è¯­è¨€ ====================
        function updateLanguageUI() {
            const langData = gameData[game.language];
            if (!langData) return;
            
            document.getElementById('dayLabel').textContent = langData.dayLabel;
            document.getElementById('luckLabel').textContent = langData.luckLabel;
            document.getElementById('moneyLabel').textContent = langData.moneyLabel;
            document.getElementById('endingTitle').textContent = langData.endingTitle;
            document.getElementById('endingResultTitle').textContent = game.language === 'zh' ? 'æœ¬æ¬¡æ˜¥èŠ‚æˆå°±' : 'This Playthrough Achievements';
            document.getElementById('fortuneTitle').textContent = langData.fortuneTitle;
            document.getElementById('shareBtn').textContent = langData.shareText;
            document.getElementById('retryBtn').textContent = langData.retryText;
            document.getElementById('homeBtn').textContent = langData.homeText;
            document.getElementById('qrcodeTitle').textContent = langData.qrcodeTitle;
            document.getElementById('qrcodeHint').textContent = langData.qrcodeHint;
            
            const chineseBtn = document.getElementById('chineseBtn');
            const englishBtn = document.getElementById('englishBtn');
            if (game.language === 'zh') {
                chineseBtn.textContent = 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡ç‰ˆ';
                englishBtn.textContent = 'ğŸŒ English Version';
                document.getElementById('drawFortuneBtn').textContent = 'âœ¨ æŠ½å–æˆ‘çš„æ–°å¹´ç­¾';
            } else {
                chineseBtn.textContent = 'ğŸ‡¨ğŸ‡³ Chinese';
                englishBtn.textContent = 'ğŸŒ English';
                document.getElementById('drawFortuneBtn').textContent = 'âœ¨ Draw My Fortune';
            }
        }

        // ==================== åŠ è½½åœºæ™¯ ====================
        function loadScene() {
            const langData = gameData[game.language];
            const scenes = langData.scenes;
            if (game.currentScene >= scenes.length) {
                showEndingPage();
                return;
            }
            const scene = scenes[game.currentScene];
            document.getElementById('sceneTitle').textContent = scene.title;
            document.getElementById('sceneText').textContent = scene.text;
            document.getElementById('currentDay').textContent = langData.days[game.currentScene];
            
            const cantoneseEl = document.getElementById('cantoneseText');
            if (scene.cantonese) {
                cantoneseEl.textContent = scene.cantonese;
                cantoneseEl.style.display = 'block';
            } else {
                cantoneseEl.style.display = 'none';
            }
            
            const sceneImg = document.getElementById('sceneImage');
            if (game.currentScene < gameImages.scenes.length) {
                sceneImg.src = gameImages.scenes[game.currentScene];
                sceneImg.onerror = function() { console.log("åœºæ™¯å›¾åŠ è½½å¤±è´¥"); sceneImg.style.display = 'none'; };
                sceneImg.style.display = 'block';
            }
            
            const optionsArea = document.getElementById('optionsArea');
            optionsArea.innerHTML = '';
            
            scene.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.innerHTML = option.text;
                button.addEventListener('click', function() {
                    game.lastOptionResult = option;
                    const optionText = option.text.replace(/[ğŸ§¹ğŸƒğŸğŸŒ¸ğŸŠğŸš¶ğŸ¥¢ğŸğŸ²ğŸ¡ğŸ®ğŸ¦]/g, '').trim();
                    game.selectedOptions.push(optionText);
                    if (option.choiceType && game.choiceTypes[option.choiceType] !== undefined) {
                        game.choiceTypes[option.choiceType]++;
                    }
                    showPolaroidModal(option);
                    if (option.luck) game.luck += option.luck;
                    if (option.money) game.money += option.money;
                    if (option.happiness) game.happiness += option.happiness;
                    if (option.collect) game.collectedItems.push(option.collect);
                    game.luck = Math.max(0, game.luck);
                    game.money = Math.max(0, game.money);
                    game.happiness = Math.max(0, game.happiness);
                    updateStatus();
                    if (navigator.vibrate) navigator.vibrate(50);
                });
                optionsArea.appendChild(button);
            });
            updateStatus();
        }

        function showPolaroidModal(option) {
            const modal = document.getElementById('polaroidModal');
            const polaroidImage = document.getElementById('polaroidImage');
            const polaroidDesc = document.getElementById('polaroidDesc');
            const polaroidStats = document.getElementById('polaroidStats');
            const polaroidCollect = document.getElementById('polaroidCollect');
            
            if (game.currentScene < gameImages.optionResults.length) {
                const sceneImages = gameImages.optionResults[game.currentScene];
                if (option.imageIndex !== undefined && option.imageIndex < sceneImages.length) {
                    polaroidImage.src = sceneImages[option.imageIndex];
                    polaroidImage.onerror = function() {
                        console.log(`é€‰é¡¹å›¾ç‰‡åŠ è½½å¤±è´¥: ${sceneImages[option.imageIndex]}`);
                        if (game.currentScene < gameImages.scenes.length) {
                            polaroidImage.src = gameImages.scenes[game.currentScene];
                        }
                    };
                } else {
                    polaroidImage.src = gameImages.scenes[game.currentScene];
                }
            } else {
                polaroidImage.src = gameImages.scenes[game.currentScene];
            }
            
            polaroidDesc.textContent = option.result;
            let statsHTML = '';
            if (option.luck) statsHTML += `<div class="stat-item"><div class="stat-value">${option.luck > 0 ? '+' : ''}${option.luck}</div><div class="stat-label">${game.language === 'zh' ? 'å¥½è¿å€¼' : 'Luck'}</div></div>`;
            if (option.money) {
                const moneyText = game.language === 'zh' ? `Â¥${option.money > 0 ? '+' : ''}${option.money}` : `$${option.money > 0 ? '+' : ''}${option.money}`;
                statsHTML += `<div class="stat-item"><div class="stat-value">${moneyText}</div><div class="stat-label">${game.language === 'zh' ? 'åˆ©æ˜¯é’±' : 'Money'}</div></div>`;
            }
            if (option.happiness) statsHTML += `<div class="stat-item"><div class="stat-value">${option.happiness > 0 ? '+' : ''}${option.happiness}</div><div class="stat-label">${game.language === 'zh' ? 'å¹¸ç¦åº¦' : 'Happiness'}</div></div>`;
            polaroidStats.innerHTML = statsHTML;
            
            if (option.collect) {
                polaroidCollect.textContent = `${game.language === 'zh' ? 'æ”¶é›†åˆ°ï¼š' : 'Collected: '}${option.collect}`;
                polaroidCollect.style.display = 'block';
            } else {
                polaroidCollect.style.display = 'none';
            }
            
            modal.classList.add('active');
            setTimeout(() => {
                game.currentScene++;
                if (game.currentScene < gameData[game.language].scenes.length) {
                    loadScene();
                } else {
                    setTimeout(showEndingPage, 500);
                }
            }, 1500);
        }

        function showEndingPage() {
            document.getElementById('gamePage').classList.remove('active');
            document.getElementById('endingPage').classList.add('active');
            const langData = gameData[game.language];
            calculateAchievements();
            const ending = determineEndingType();
            const endingImg = document.getElementById('endingImage');
            if (ending && ending.imageType && gameImages.endings[ending.imageType]) {
                endingImg.src = gameImages.endings[ending.imageType];
            } else {
                endingImg.src = gameImages.endings.default;
            }
            document.getElementById('endingResultTitle').textContent = game.language === 'zh' ? 'æ‚¨çš„æ˜¥èŠ‚ç±»å‹' : 'Your New Year Type';
            document.getElementById('endingResultText').textContent = game.language === 'zh' ? 'æ ¹æ®æ‚¨çš„é€‰æ‹©å’Œè¡¨ç°ï¼Œæ‚¨çš„æ˜¥èŠ‚å±äºï¼š' : 'Based on your choices, your New Year celebration is:';
            document.getElementById('endingTypeTitle').textContent = ending.title;
            document.getElementById('endingTypeDesc').textContent = ending.desc;
            
            document.getElementById('endingStats').innerHTML = `
                <div class="ending-stat-item"><div class="ending-stat-value">${game.luck}</div><div class="ending-stat-label">${langData.luckLabel}</div></div>
                <div class="ending-stat-item"><div class="ending-stat-value">${game.language === 'zh' ? 'Â¥' : '$'}${game.money}</div><div class="ending-stat-label">${langData.moneyLabel}</div></div>
                <div class="ending-stat-item"><div class="ending-stat-value">${game.happiness}</div><div class="ending-stat-label">${game.language === 'zh' ? 'å¹¸ç¦åº¦' : 'Happiness'}</div></div>
            `;
            
            const achievementList = document.getElementById('achievementList');
            if (game.achievements.length > 0) {
                let achievementsHTML = `<h4>${game.language === 'zh' ? 'ğŸ‰ æœ¬æ¬¡è·å¾—çš„æˆå°±' : 'ğŸ‰ Achievements Earned'}</h4>`;
                const earnedAchievements = langData.achievements.filter(ach => game.achievements.includes(ach.id));
                earnedAchievements.forEach(ach => {
                    achievementsHTML += `<div class="achievement-item"><div class="achievement-icon">${ach.icon}</div><div class="achievement-name">${ach.name}</div><div class="achievement-desc">${ach.desc}</div></div>`;
                });
                achievementsHTML += `<div style="margin-top:15px;padding:10px;background:#fff9e6;border-radius:8px;border:1px dashed #ff9a9e;"><strong>${game.language === 'zh' ? 'æœ¬æ¬¡å…±è·å¾—ï¼š' : 'Total earned: '}</strong><span style="color:#c1272d;font-weight:bold;">${game.achievements.length}</span>${game.language === 'zh' ? 'ä¸ªæˆå°±' : ' achievements'}</div>`;
                achievementList.innerHTML = achievementsHTML;
            } else {
                achievementList.innerHTML = `<div class="no-achievement">${game.language === 'zh' ? 'è¿™æ¬¡æ²¡æœ‰è·å¾—ç‰¹æ®Šæˆå°±ï¼Œä¸‹æ¬¡è¯•è¯•ä¸åŒçš„é€‰æ‹©å§ï¼' : 'No special achievements this time. Try different choices next time!'}</div>`;
            }
            document.getElementById('endingConclusion').textContent = game.language === 'zh' ? 'ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŠ½å–æ‚¨çš„æ–°å¹´å¥½è¿ç­¾ï¼' : 'Click below to draw your New Year fortune!';
        }

        function calculateAchievements() {
            const langData = gameData[game.language];
            game.achievements = [];
            langData.achievements.forEach(ach => { if (ach.condition(game)) game.achievements.push(ach.id); });
        }

        function determineEndingType() {
            const langData = gameData[game.language];
            for (let ending of langData.endings) { if (ending.condition(game)) return ending; }
            return langData.endings[0];
        }

        function updateStatus() {
            document.getElementById('luckValue').textContent = game.luck;
            document.getElementById('moneyValue').textContent = (game.language === 'zh' ? 'Â¥' : '$') + game.money;
        }

        function showFortunePage() {
            document.getElementById('endingPage').classList.remove('active');
            document.getElementById('fortunePage').classList.add('active');
            drawFortune();
        }

        function drawFortune() {
            const fortunes = gameImages.fortunes;
            let randomIndex;
            if (game.luck >= 140) randomIndex = Math.floor(Math.random() * 2);
            else if (game.luck >= 120) randomIndex = Math.floor(Math.random() * 3);
            else randomIndex = Math.floor(Math.random() * fortunes.length);
            const fortune = fortunes[randomIndex];
            const fortuneImg = document.getElementById('fortuneImage');
            fortuneImg.src = fortune.image;
            fortuneImg.onerror = function() { console.log("æ–°å¹´ç­¾å›¾ç‰‡åŠ è½½å¤±è´¥"); fortuneImg.style.display = 'none'; };
            fortuneImg.style.display = 'block';
            const fortuneText = document.getElementById('fortuneText');
            fortuneText.textContent = game.language === 'zh' ? fortune.text.zh : fortune.text.en;
        }

        function shareFortune() {
            const fortuneText = document.getElementById('fortuneText').textContent;
            const shareMsg = game.language === 'zh' ? `ğŸ´ æˆ‘åœ¨ã€Šå¹¿åºœå¹´å‘³ä¹‹æ—…ã€‹æŠ½åˆ°é©¬å¹´å¥½è¿ç­¾ï¼š${fortuneText}\n\nå¿«æ¥æ‰«ç ä¸€èµ·ä½“éªŒå¹¿ä¸œæ˜¥èŠ‚ä¹ ä¿—å§ï¼` : `ğŸ My Year of the Horse fortune: "${fortuneText}"\n\nScan to play Guangdong New Year Journey!`;
            if (navigator.share) navigator.share({ title: game.language === 'zh' ? 'å¹¿åºœå¹´å‘³ä¹‹æ—…' : 'Guangdong New Year Journey', text: shareMsg });
            else navigator.clipboard.writeText(shareMsg).then(() => showMessage(game.language === 'zh' ? 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿' : 'Copied to clipboard'));
        }

        function showMessage(text) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 1500);
        }

        function backToHome() {
            document.getElementById('fortunePage').classList.remove('active');
            document.getElementById('endingPage').classList.remove('active');
            document.getElementById('languagePage').classList.add('active');
            game.currentScene = 0;
            game.luck = 88;
            game.money = 100;
            game.happiness = 100;
            game.collectedItems = [];
            game.achievements = [];
            game.selectedOptions = [];
            game.choiceTypes = { traditional: 0, modern: 0, family: 0, social: 0 };
        }

        window.onload = init;
    </script>
</body>
</html>








